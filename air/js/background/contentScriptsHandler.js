chrome.extension.onRequest.addListener(function(n,t){if(n.ticketEvent=="refresh"&&n.times==0){chrome.tabs.sendRequest(t.tab.id,{ticketEvent:"flightHide"});return}n.ticketEvent==="refresh"&&n.times===config.for12306.ticketTimes&&chrome.tabs.sendRequest(t.tab.id,{ticketEvent:"get12306Query"},function(n){for(var i=[],r,f=(n.date[1]-n.date[0])/864e5+1,u=n.date[0];u<=n.date[1];u+=864e5)r=FlightFactory.getFromShort({shortFrom:n.shortFrom,shortTo:n.shortTo,date:[u,u]}),r.getData(!1,!0,function(n){i.push(n.main)},function(){},function(){f--;f==0&&i.length&&(i.sort(function(n,t){return n.date>t.date?1:n.date<t.date?-1:0}),chrome.tabs.sendRequest(t.tab.id,{ticketEvent:"flightShow",version:baseInfo.getInstance().info.version,query:{from:r.query.from,to:r.query.to},data:i,context:n.context===undefined?{}:n.context},function(n){n.status&&Statistics.trigger(57)}))})})})